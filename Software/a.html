<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Reservas - Restaurante</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
:root {
  --mesa-disponible: #28a745;
  --mesa-ocupada: #007bff;
  --mesa-deshabilitada: #6c757d;
}

body {
  background: #ffffff;
  color: #212529;
}

.app-container {
  max-width: 70%;
  margin: 25px auto;
}

.mesa-card.disponible {
  border: 3px solid var(--mesa-disponible);
}
.mesa-card.ocupada {
  border: 3px solid var(--mesa-ocupada);
}
.mesa-card.deshabilitada {
  border: 3px solid var(--mesa-deshabilitada);
  color: #282828;
  background: #f1f3f5;
}

.mesa-state-chip {
  font-size: .75rem;
  padding: .2rem .5rem;
  border-radius: 999px;
  color: #000000;
}
.mesa-state-chip.disponible {
  background: var(--mesa-disponible);
}
.mesa-state-chip.ocupada {
  background: var(--mesa-ocupada);
}
.mesa-state-chip.deshabilitada {
  background: #adb5bd;
}

.reserva-card {
  border: 3px solid #006fde;
}
  </style>
</head>
<body>
  <div class="app-container px-3">
    <header class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-shop fs-3"></i>
        <h1 class="h3 m-0">Reservas & Mesas</h1>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-success" onclick="openMesaModal()">
          <i class="bi bi-plus-circle"></i> Nueva Mesa
        </button>
        <button class="btn btn-primary" onclick="openReservaModal()">
          <i class="bi bi-calendar-plus"></i> Nueva Reserva
        </button>
      </div>
    </header>

    <!-- Plano -->
    <section>
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h5">Plano del restaurante</h2>
        <small>Estados: 
          <span class="badge" style="background:#28a745">Disponible</span> 
          <span class="badge bg-primary">Ocupada</span> 
          <span class="badge text-bg-dark">Deshabilitada</span>
        </small>
      </div>
      <div id="mesasGrid" class="row g-3"></div>
    </section>

    <!-- Reservas -->
    <section class="my-4">
      <h2 class="h5 mb-3">Reservas</h2>
      <div id="reservasGrid" class="row g-3"></div>
    </section>
  </div>

  <!-- Modal Mesa -->
  <div class="modal fade" id="mesaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Mesa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="mesaForm" class="row g-3">
            <div class="col-12">
              <label class="form-label">ID mesa</label>
              <input id="mesaId" class="form-control" placeholder="mesa1, mesa2..." required />
            </div>
            <div class="col-6">
              <label class="form-label">Capacidad</label>
              <input id="mesaCapacidad" type="number" class="form-control" min="1" value="2" required />
            </div>
            <div class="col-6">
              <label class="form-label">Ubicación</label>
              <input id="mesaUbicacion" class="form-control" placeholder="Ventana, Jardín..." required />
            </div>
            <div class="col-12">
              <label class="form-label">Estado</label>
              <select id="mesaEstado" class="form-select" required>
                <option>disponible</option>
                <option>ocupada</option>
                <option>deshabilitada</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button class="btn btn-success" id="btnGuardarMesa"><i class="bi bi-check2-circle"></i> Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Reserva -->
  <div class="modal fade" id="reservaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Reserva</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="reservaForm" class="row g-3">
            <div class="col-6">
              <label class="form-label">Cliente</label>
              <input id="reservaCliente" class="form-control" required />
            </div>
            <div class="col-6">
              <label class="form-label">Teléfono</label>
              <input id="reservaTelefono" class="form-control" required />
            </div>
            <div class="col-6">
              <label class="form-label">Fecha</label>
              <input id="reservaFecha" type="date" class="form-control" required />
            </div>
            <div class="col-6">
              <label class="form-label">Hora</label>
              <input id="reservaHora" type="time" class="form-control" required />
            </div>
            <div class="col-6">
              <label class="form-label">Personas</label>
              <input id="reservaPersonas" type="number" class="form-control" min="1" value="2" required />
            </div>
            <div class="col-6">
              <label class="form-label">Mesa</label>
              <select id="reservaMesa" class="form-select" required></select>
            </div>
            <div class="col-12">
              <label class="form-label">Estado</label>
              <select id="reservaEstado" class="form-select" required>
                <option>Pendiente</option>
                <option>Confirmada</option>
                <option>Cancelada</option>
                <option>Finalizada</option>
                <option>No Show</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button class="btn btn-success" id="btnGuardarReserva"><i class="bi bi-check2-circle"></i> Guardar</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
<script>
const LS_KEYS = { MESAS: 'mesas', RESERVAS: 'reservas' };
const getLS = (key) => JSON.parse(localStorage.getItem(key) || '[]');
const setLS = (key, value) => localStorage.setItem(key, JSON.stringify(value));

let mesas = [];
let reservas = [];
let currentMesaId = null;
let currentReservaId = null;


  function notify(msg, type = 'success') {
  Swal.fire({
    position: 'top',
    icon: type,
    title: msg,
    showConfirmButton: false,
    timer: 2000,
    toast: true
  });
}



function confirmar(msg, cb) {
  Swal.fire({ title: msg, icon: 'warning', showCancelButton: true, confirmButtonText: 'Sí', cancelButtonText: 'Cancelar' })
    .then(res => { if (res.isConfirmed) cb(); });
    
}

function initMesasDefault() {
  if (!localStorage.getItem(LS_KEYS.MESAS)) setLS(LS_KEYS.MESAS, []);
  if (!localStorage.getItem(LS_KEYS.RESERVAS)) setLS(LS_KEYS.RESERVAS, []);
}

function renderMesas() {
  const cont = document.getElementById('mesasGrid');
  cont.innerHTML = '';
  mesas.forEach(m => {
    const col = document.createElement('div');
    col.className = 'col-12 col-md-6 col-lg-4';
    col.innerHTML = `
      <div class="card mesa-card ${m.estado}">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <strong>${m.id.toUpperCase()}</strong>
            <span class="mesa-state-chip ${m.estado}">${m.estado}</span>
          </div>
          <div class="mt-2 small text-muted">
            <div><i class="bi bi-people"></i> Capacidad: ${m.capacidad}</div>
            <div><i class="bi bi-geo-alt"></i> ${m.ubicacion}</div>
          </div>
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-warning btn-sm" onclick="openMesaModal('${m.id}')"><i class="bi bi-pencil-square"></i></button>
            <button class="btn btn-primary btn-sm" onclick="openReservaModal(null,'${m.id}')"><i class="bi bi-calendar-plus"></i></button>
            <button class="btn btn-danger btn-sm" onclick="confirmar('¿Eliminar mesa ${m.id}?', ()=> eliminarMesa('${m.id}'))"><i class="bi bi-trash"></i></button>
          </div>
        </div>
      </div>`;
    cont.appendChild(col);
  });
}

function renderReservas() {
  const cont = document.getElementById('reservasGrid');
  cont.innerHTML = '';
  reservas.forEach(r => {
    const col = document.createElement('div');
    col.className = 'col-12 col-md-6 col-lg-4';
    col.innerHTML = `
      <div class="card reserva-card">
        <div class="card-body">
          <h5>${r.cliente}</h5>
          <p class="small mb-1">${r.telefono}</p>
          <p class="small mb-1">${r.fecha} ${r.hora}</p>
          <p class="small mb-1">Mesa: ${r.mesa} | ${r.personas} personas</p>
          <span class="badge bg-secondary">${r.estado}</span>
        </div>
        <div class="card-footer d-flex gap-2">
          <button class="btn btn-warning btn-sm" onclick="openReservaModal('${r.id}')">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn btn-danger btn-sm" onclick="confirmar('¿Eliminar reserva?', ()=> eliminarReserva('${r.id}'))">
            <i class="bi bi-trash"></i>
          </button>
          ${r.estado === 'Confirmada' ? `
          <button class="btn btn-success btn-sm" onclick="pagarReserva('${r.id}')">
            <i class="bi bi-cash-stack"></i> Pagar
          </button>` : ''}
        </div>
      </div>`;
    cont.appendChild(col);
  });
}

function openMesaModal(id=null){
  currentMesaId=id;
  const form=document.getElementById('mesaForm');form.reset();
  if(id){
    const m=mesas.find(x=>x.id===id);
    document.getElementById('mesaId').value=m.id;
    document.getElementById('mesaCapacidad').value=m.capacidad;
    document.getElementById('mesaUbicacion').value=m.ubicacion;
    document.getElementById('mesaEstado').value=m.estado;
  }
  new bootstrap.Modal('#mesaModal').show();
}

function openReservaModal(id=null,mesaId=null){
  currentReservaId=id;
  const form=document.getElementById('reservaForm');form.reset();
  const selectMesa=document.getElementById('reservaMesa');
  const disponibles=mesas.filter(m=>m.estado==='disponible');
  selectMesa.innerHTML=disponibles.map(m=>`<option value="${m.id}">${m.id}</option>`).join('');
  if(id){
    const r=reservas.find(r=>r.id===id);
    document.getElementById('reservaCliente').value=r.cliente;
    document.getElementById('reservaTelefono').value=r.telefono;
    document.getElementById('reservaFecha').value=r.fecha;
    document.getElementById('reservaHora').value=r.hora;
    document.getElementById('reservaPersonas').value=r.personas;
    document.getElementById('reservaMesa').value=r.mesa;
    document.getElementById('reservaEstado').value=r.estado;
  } else if(mesaId){
    if(disponibles.some(m=>m.id===mesaId)){
      document.getElementById('reservaMesa').value=mesaId;
    } else {
      notify('La mesa seleccionada no está disponible','error');
    }
  }
  new bootstrap.Modal('#reservaModal').show();
}

document.getElementById('btnGuardarMesa').onclick=()=>{
  const id=document.getElementById('mesaId').value.trim();
  const capacidad=parseInt(document.getElementById('mesaCapacidad').value);
  const ubicacion=document.getElementById('mesaUbicacion').value.trim();
  const estado=document.getElementById('mesaEstado').value;
  if(!id)return notify('ID obligatorio','error');
  if(currentMesaId){
    const m=mesas.find(x=>x.id===currentMesaId);
    Object.assign(m,{id,capacidad,ubicacion,estado});
  } else {
    mesas.push({id,capacidad,ubicacion,estado});
  }
  setLS(LS_KEYS.MESAS,mesas);
  renderMesas();
  bootstrap.Modal.getInstance(document.getElementById('mesaModal')).hide();
  currentMesaId=null;
  notify('Mesa guardada');
};

document.getElementById('btnGuardarReserva').onclick=()=>{
  const cliente=document.getElementById('reservaCliente').value.trim();
  const telefono=document.getElementById('reservaTelefono').value.trim();
  const fecha=document.getElementById('reservaFecha').value;
  const hora=document.getElementById('reservaHora').value;
  const personas=parseInt(document.getElementById('reservaPersonas').value);
  const mesa=document.getElementById('reservaMesa').value;
  const estado=document.getElementById('reservaEstado').value;
  if(!cliente||!fecha||!hora)return notify('Datos incompletos','error');
  
  if(!currentReservaId && reservas.some(r=>r.mesa===mesa && r.fecha===fecha && r.hora===hora)){
    return notify('Ya existe una reserva para esa mesa y hora','error');
  }

  if(currentReservaId){
    const r=reservas.find(r=>r.id===currentReservaId);
    Object.assign(r,{cliente,telefono,fecha,hora,personas,mesa,estado});
  } else {
    reservas.push({id:'r'+Date.now(),cliente,telefono,fecha,hora,personas,mesa,estado});
  }

  if(estado==='Confirmada'){
    const mesaObj=mesas.find(m=>m.id===mesa);
    if(mesaObj)mesaObj.estado='ocupada';
  }

  setLS(LS_KEYS.MESAS,mesas);
  setLS(LS_KEYS.RESERVAS,reservas);
  renderMesas();
  renderReservas();
  bootstrap.Modal.getInstance(document.getElementById('reservaModal')).hide();
  currentReservaId=null;
  notify('Reserva guardada');
};

function pagarReserva(id){
  const r=reservas.find(r=>r.id===id);
  if(!r)return;
  Swal.fire({
    title:'¿Desea pagar y liberar la mesa?',
    icon:'question',
    showCancelButton:true,
    confirmButtonText:'Sí, pagar',
    cancelButtonText:'Cancelar'
  }).then(res=>{
    if(res.isConfirmed){
      r.estado='Finalizada';
      const mesaObj=mesas.find(m=>m.id===r.mesa);
      if(mesaObj)mesaObj.estado='disponible';
      setLS(LS_KEYS.MESAS,mesas);
      setLS(LS_KEYS.RESERVAS,reservas);
      renderMesas();
      renderReservas();
      notify('Pago realizado y mesa liberada');
    }
  });
}

function eliminarMesa(id){mesas=mesas.filter(m=>m.id!==id);setLS(LS_KEYS.MESAS,mesas);renderMesas();notify('Mesa eliminada');}
function eliminarReserva(id){reservas=reservas.filter(r=>r.id!==id);setLS(LS_KEYS.RESERVAS,reservas);renderReservas();notify('Reserva eliminada');}

(function boot(){initMesasDefault();mesas=getLS(LS_KEYS.MESAS);reservas=getLS(LS_KEYS.RESERVAS);renderMesas();renderReservas();notify('Datos cargados');})();
</script>
</body>
</html>