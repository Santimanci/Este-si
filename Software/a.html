<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Reservas - Restaurante</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --mesa-disponible: #28a745;
      --mesa-ocupada: #007bff;
      --mesa-deshabilitada: #6c757d;
    }

    body {
      background: #ffffff;
      color: #212529;
      background-image: url(image.png);
      background-size: cover;
      background-attachment: fixed;
    }

    .app-container {
      max-width: 70%;
      margin: 25px auto;
    }

    .mesa-card.disponible {
      border: 3px solid var(--mesa-disponible);
    }

    .mesa-card.ocupada {
      border: 3px solid var(--mesa-ocupada);
    }

    .mesa-card.deshabilitada {
      border: 3px solid var(--mesa-deshabilitada);
      color: #282828;
      background: #f1f3f5;
    }

    .mesa-state-chip {
      font-size: .75rem;
      padding: .2rem .5rem;
      border-radius: 999px;
      color: #000000;
    }

    .mesa-state-chip.disponible {
      background: var(--mesa-disponible);
    }

    .mesa-state-chip.ocupada {
      background: var(--mesa-ocupada);
    }

    .mesa-state-chip.deshabilitada {
      background: #adb5bd;
    }

    .reserva-card {
      border: 3px solid #006fde;
    }

    .card-body {
      background-image: url(image\ copy.png);
      background-size: cover;
      width: 50%;
      height: 40%;
    }

    .filter-section {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .filter-toggle {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="app-container px-3">
    <header class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-shop fs-3"></i>
        <h1 class="h3 m-0">Reservas & Mesas</h1>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-success" onclick="openMesaModal()">
          <i class="bi bi-plus-circle"></i> Nueva Mesa
        </button>
        <button class="btn btn-primary" onclick="openReservaModal()">
          <i class="bi bi-calendar-plus"></i> Nueva Reserva
        </button>
      </div>
    </header>

    <!-- Plano -->
    <section>
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h5">Plano del restaurante</h2>
        <small>Estados:
          <span class="badge" style="background:#28a745">Disponible</span>
          <span class="badge bg-primary">Ocupada</span>
          <span class="badge text-bg-dark">Deshabilitada</span>
        </small>
      </div>
      <div id="mesasGrid" class="row g-3"></div>
    </section>

    <!-- Reservas -->
    <section class="my-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">Reservas</h2>
        <button class="btn btn-outline-primary btn-sm filter-toggle" onclick="toggleFilters()">
          <i class="bi bi-funnel"></i> Filtros
        </button>
      </div>
      
      <!-- Panel de Filtros -->
      <div class="filter-section mb-3" id="filtersPanel" style="display: none;">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Fecha desde</label>
            <input type="date" class="form-control" id="filterFechaDesde">
          </div>
          <div class="col-md-3">
            <label class="form-label">Fecha hasta</label>
            <input type="date" class="form-control" id="filterFechaHasta">
          </div>
          <div class="col-md-3">
            <label class="form-label">Estado</label>
            <select class="form-select" id="filterEstado">
              <option value="">Todos los estados</option>
              <option value="Pendiente">Pendiente</option>
              <option value="Confirmada">Confirmada</option>
              <option value="Cancelada">Cancelada</option>
              <option value="Finalizada">Finalizada</option>
              <option value="No Show">No Show</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Mesa</label>
            <select class="form-select" id="filterMesa">
              <option value="">Todas las mesas</option>
            </select>
          </div>
          <div class="col-12 d-flex justify-content-end gap-2">
            <button class="btn btn-secondary" onclick="clearFilters()">
              <i class="bi bi-x-circle"></i> Limpiar
            </button>
            <button class="btn btn-primary" onclick="applyFilters()">
              <i class="bi bi-check-circle"></i> Aplicar
            </button>
          </div>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th>Cliente</th>
              <th>Teléfono</th>
              <th>Fecha</th>
              <th>Hora Inicio</th>
              <th>Hora Fin</th>
              <th>Personas</th>
              <th>Mesa</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="reservasGrid"></tbody>
        </table>
      </div>
    </section>


    <!-- Modal Mesa -->
    <div class="modal fade" id="mesaModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Mesa</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="mesaForm" class="row g-3">
              <div class="col-12">
                <label class="form-label">ID mesa</label>
                <input id="mesaId" class="form-control" placeholder="mesa1, mesa2..." required />
              </div>
              <div class="col-6">
                <label class="form-label">Capacidad</label>
                <input id="mesaCapacidad" type="number" class="form-control" min="1" value="2" required />
              </div>
              <div class="col-6">
                <label class="form-label">Ubicación</label>
                <input id="mesaUbicacion" class="form-control" placeholder="Ventana, Jardín..." required />
              </div>
              <div class="col-12">
                <label class="form-label">Estado</label>
                <select id="mesaEstado" class="form-select" required>
                  <option>disponible</option>
                  <option>ocupada</option>
                  <option>deshabilitada</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button class="btn btn-success" id="btnGuardarMesa"><i class="bi bi-check2-circle"></i> Guardar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Reserva -->
    <div class="modal fade" id="reservaModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Reserva</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="reservaForm" class="row g-3">
              <div class="col-6">
                <label class="form-label">Cliente</label>
                <input id="reservaCliente" class="form-control" required />
              </div>
              <div class="col-6">
                <label class="form-label">Teléfono</label>
                <input id="reservaTelefono" class="form-control" required />
              </div>
              <div class="col-6">
                <label class="form-label">Fecha</label>
                <input id="reservaFecha" type="date" class="form-control" required />
              </div>
              <div class="col-3">
                <label class="form-label">Hora Inicio</label>
                <input id="reservaHoraInicio" type="time" class="form-control" required />
              </div>
              <div class="col-3">
                <label class="form-label">Hora Fin</label>
                <input id="reservaHoraFin" type="time" class="form-control" required />
              </div>
              <div class="col-6">
                <label class="form-label">Personas</label>
                <input id="reservaPersonas" type="number" class="form-control" min="1" value="2" required />
              </div>
              <div class="col-6">
                <label class="form-label">Mesa</label>
                <select id="reservaMesa" class="form-select" required></select>
              </div>
              <div class="col-12">
                <label class="form-label">Ocasión especial</label>
                <select id="reservaOcasión" class="form-select" required>
                  <option value="ninguna">Ninguna</option>
                  <option value="cumpleaños">Cumpleaños</option>
                  <option value="aniversario">Aniversario</option>
                  <option value="negocios">Reunión de Negocios</option>
                  <option value="despedida">Despedida</option>
                  <option value="romantica">Cena Romántica</option>
                  <option value="graduacion">Graduación</option>
                  <option value="familiar">Reunión Familiar</option>
                  <option value="otro">Otro</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Estado</label>
                <select id="reservaEstado" class="form-select" required>
                  <option>Pendiente</option>
                  <option>Confirmada</option>
                  <option>Cancelada</option>
                  <option>Finalizada</option>
                  <option>No Show</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button class="btn btn-success" id="btnGuardarReserva"><i class="bi bi-check2-circle"></i> Guardar</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const LS_KEYS = { MESAS: 'mesas', RESERVAS: 'reservas' };
      const getLS = (key) => JSON.parse(localStorage.getItem(key) || '[]');
      const setLS = (key, value) => localStorage.setItem(key, JSON.stringify(value));

      let mesas = [];
      let reservas = [];
      let currentMesaId = null;
      let currentReservaId = null;
      let filteredReservas = [];
      let filtersActive = false;

      // Función para obtener la fecha actual en formato YYYY-MM-DD
      function getCurrentDate() {
        const today = new Date();
        return today.toISOString().split('T')[0];
      }

      // Función para obtener la hora actual en formato HH:MM
      function getCurrentTime() {
        const now = new Date();
        return now.toTimeString().slice(0, 5);
      }

      // Función para verificar si una fecha es hoy
      function isToday(date) {
        return date === getCurrentDate();
      }

      // Función para verificar si una reserva está activa ahora
      function isReservaActiva(reserva) {
        if (!isToday(reserva.fecha)) return false;
        
        const now = new Date();
        const currentTime = now.toTimeString().slice(0, 5);
        
        // Crear objetos Date para comparar horas
        const startTime = reserva.horaInicio;
        const endTime = reserva.horaFin;
        
        return currentTime >= startTime && currentTime <= endTime;
      }

      function notify(msg, type = 'success') {
        Swal.fire({
          position: 'top',
          icon: type,
          title: msg,
          showConfirmButton: false,
          timer: 2000,
          toast: true
        });
      }

      function confirmar(msg, cb) {
        Swal.fire({ title: msg, icon: 'warning', showCancelButton: true, confirmButtonText: 'Sí', cancelButtonText: 'Cancelar' })
          .then(res => { if (res.isConfirmed) cb(); });
      }

      function initMesasDefault() {
        if (!localStorage.getItem(LS_KEYS.MESAS)) setLS(LS_KEYS.MESAS, []);
        if (!localStorage.getItem(LS_KEYS.RESERVAS)) setLS(LS_KEYS.RESERVAS, []);
      }

      function actualizarEstadoMesas() {
        // Primero, establecer todas las mesas como disponibles
        mesas.forEach(mesa => {
          if (mesa.estado !== 'deshabilitada') {
            mesa.estado = 'disponible';
          }
        });

        // Luego, buscar reservas activas para hoy y marcar las mesas como ocupadas
        const hoy = getCurrentDate();
        reservas.forEach(reserva => {
          if (reserva.estado === 'Confirmada' && reserva.fecha === hoy && isReservaActiva(reserva)) {
            const mesa = mesas.find(m => m.id === reserva.mesa);
            if (mesa && mesa.estado !== 'deshabilitada') {
              mesa.estado = 'ocupada';
            }
          }
        });
      }

      function renderMesas() {
        actualizarEstadoMesas();
        const cont = document.getElementById('mesasGrid');
        cont.innerHTML = '';
        mesas.forEach(m => {
          const col = document.createElement('div');
          col.className = 'col-12 col-md-6 col-lg-4';
          col.innerHTML = `
        <div class="card mesa-card ${m.estado}">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <strong>${m.id.toUpperCase()}</strong>
              <span class="mesa-state-chip ${m.estado}">${m.estado}</span>
            </div>
            <div class="mt-2 small text-muted">
              <div><i class="bi bi-people"></i> Capacidad: ${m.capacidad}</div>
              <div><i class="bi bi-geo-alt"></i> ${m.ubicacion}</div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-warning btn-sm" onclick="openMesaModal('${m.id}')"><i class="bi bi-pencil-square"></i></button>
              <button class="btn btn-primary btn-sm" onclick="openReservaModal(null,'${m.id}')"><i class="bi bi-calendar-plus"></i></button>
              <button class="btn btn-danger btn-sm" onclick="confirmar('¿Eliminar mesa ${m.id}?', ()=> eliminarMesa('${m.id}'))"><i class="bi bi-trash"></i></button>
            </div>
          </div>
        </div>`;
          cont.appendChild(col);
        });
      }

      function renderReservas() {
        const cont = document.getElementById('reservasGrid');
        cont.innerHTML = '';
        
        const reservasToRender = filtersActive ? filteredReservas : reservas;
        
        if (reservasToRender.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = `<td colspan="9" class="text-center">No hay reservas para mostrar</td>`;
          cont.appendChild(row);
          return;
        }
        
        reservasToRender.forEach(r => {
          const row = document.createElement('tr');
          row.innerHTML = `
        <td>${r.cliente}</td>
        <td>${r.telefono}</td>
        <td>${r.fecha}</td>
        <td>${r.horaInicio}</td>
        <td>${r.horaFin}</td>
        <td>${r.personas}</td>
        <td>${r.mesa}</td>
        <td><span class="badge ${getEstadoBadgeClass(r.estado)}">${r.estado}</span></td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="openReservaModal('${r.id}')">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn btn-danger btn-sm" onclick="confirmar('¿Eliminar reserva?', ()=> eliminarReserva('${r.id}'))">
            <i class="bi bi-trash"></i>
          </button>
          ${r.estado === 'Confirmada' ? `
          <button class="btn btn-success btn-sm" onclick="pagarReserva('${r.id}')">
            <i class="bi bi-cash-stack"></i>
          </button>` : ''}
        </td>
      `;
          cont.appendChild(row);
        });
      }

      function getEstadoBadgeClass(estado) {
        switch(estado) {
          case 'Confirmada': return 'bg-primary';
          case 'Pendiente': return 'bg-warning text-dark';
          case 'Cancelada': return 'bg-danger';
          case 'Finalizada': return 'bg-success';
          case 'No Show': return 'bg-secondary';
          default: return 'bg-secondary';
        }
      }

      function openMesaModal(id = null) {
        currentMesaId = id;
        const form = document.getElementById('mesaForm'); form.reset();
        if (id) {
          const m = mesas.find(x => x.id === id);
          document.getElementById('mesaId').value = m.id;
          document.getElementById('mesaCapacidad').value = m.capacidad;
          document.getElementById('mesaUbicacion').value = m.ubicacion;
          document.getElementById('mesaEstado').value = m.estado;
        }
        new bootstrap.Modal('#mesaModal').show();
      }

      function openReservaModal(id = null, mesaId = null) {
        currentReservaId = id;
        const form = document.getElementById('reservaForm'); form.reset();
        const selectMesa = document.getElementById('reservaMesa');
        
        // Establecer fecha y hora por defecto
        document.getElementById('reservaFecha').value = getCurrentDate();
        document.getElementById('reservaHoraInicio').value = '19:00';
        document.getElementById('reservaHoraFin').value = '21:00';
        
        // Cargar mesas disponibles
        const disponibles = mesas.filter(m => m.estado !== 'deshabilitada');
        selectMesa.innerHTML = disponibles.map(m => `<option value="${m.id}">${m.id}</option>`).join('');
        
        if (id) {
          const r = reservas.find(r => r.id === id);
          document.getElementById('reservaCliente').value = r.cliente;
          document.getElementById('reservaTelefono').value = r.telefono;
          document.getElementById('reservaFecha').value = r.fecha;
          document.getElementById('reservaHoraInicio').value = r.horaInicio;
          document.getElementById('reservaHoraFin').value = r.horaFin;
          document.getElementById('reservaPersonas').value = r.personas;
          document.getElementById('reservaMesa').value = r.mesa;
          document.getElementById('reservaEstado').value = r.estado;
          document.getElementById('reservaOcasión').value = r.ocasion || 'ninguna';
        } else if (mesaId) {
          if (disponibles.some(m => m.id === mesaId)) {
            document.getElementById('reservaMesa').value = mesaId;
          } else {
            notify('La mesa seleccionada no está disponible', 'error');
          }
        }
        new bootstrap.Modal('#reservaModal').show();
      }

      function validarHorasReserva(horaInicio, horaFin) {
        if (horaInicio >= horaFin) {
          notify('La hora de inicio debe ser anterior a la hora de fin', 'error');
          return false;
        }
        return true;
      }

      function verificarDisponibilidadMesa(mesaId, fecha, horaInicio, horaFin, excluirReservaId = null) {
        // Verificar si la mesa está disponible en el rango de horas solicitado
        const reservasExistentes = reservas.filter(r => 
          r.mesa === mesaId && 
          r.fecha === fecha && 
          r.estado === 'Confirmada' &&
          r.id !== excluirReservaId
        );
        
        for (const reserva of reservasExistentes) {
          // Verificar si hay superposición de horarios
          if (!(horaFin <= reserva.horaInicio || horaInicio >= reserva.horaFin)) {
            return false; // Hay conflicto de horarios
          }
        }
        
        return true; // No hay conflictos
      }

      // Funciones para los filtros
      function toggleFilters() {
        const filtersPanel = document.getElementById('filtersPanel');
        filtersPanel.style.display = filtersPanel.style.display === 'none' ? 'block' : 'none';
      }

      function applyFilters() {
        const fechaDesde = document.getElementById('filterFechaDesde').value;
        const fechaHasta = document.getElementById('filterFechaHasta').value;
        const estado = document.getElementById('filterEstado').value;
        const mesa = document.getElementById('filterMesa').value;
        
        filteredReservas = reservas.filter(reserva => {
          // Filtro por fecha
          if (fechaDesde && reserva.fecha < fechaDesde) return false;
          if (fechaHasta && reserva.fecha > fechaHasta) return false;
          
          // Filtro por estado
          if (estado && reserva.estado !== estado) return false;
          
          // Filtro por mesa
          if (mesa && reserva.mesa !== mesa) return false;
          
          return true;
        });
        
        filtersActive = true;
        renderReservas();
        notify('Filtros aplicados');
      }

      function clearFilters() {
        document.getElementById('filterFechaDesde').value = '';
        document.getElementById('filterFechaHasta').value = '';
        document.getElementById('filterEstado').value = '';
        document.getElementById('filterMesa').value = '';
        
        filtersActive = false;
        renderReservas();
        notify('Filtros limpiados');
      }

      function populateMesaFilter() {
        const filterMesa = document.getElementById('filterMesa');
        // Obtener todas las mesas únicas de las reservas
        const mesasUnicas = [...new Set(reservas.map(r => r.mesa))].sort();
        
        // Limpiar y agregar opciones
        filterMesa.innerHTML = '<option value="">Todas las mesas</option>';
        mesasUnicas.forEach(mesa => {
          filterMesa.innerHTML += `<option value="${mesa}">${mesa}</option>`;
        });
      }

      document.getElementById('btnGuardarMesa').onclick = () => {
        const id = document.getElementById('mesaId').value.trim();
        const capacidad = parseInt(document.getElementById('mesaCapacidad').value);
        const ubicacion = document.getElementById('mesaUbicacion').value.trim();
        const estado = document.getElementById('mesaEstado').value;
        if (!id) return notify('ID obligatorio', 'error');
        if (currentMesaId) {
          const m = mesas.find(x => x.id === currentMesaId);
          Object.assign(m, { id, capacidad, ubicacion, estado });
        } else {
          mesas.push({ id, capacidad, ubicacion, estado });
        }
        setLS(LS_KEYS.MESAS, mesas);
        renderMesas();
        bootstrap.Modal.getInstance(document.getElementById('mesaModal')).hide();
        currentMesaId = null;
        notify('Mesa guardada');
      };

      document.getElementById('btnGuardarReserva').onclick = () => {
        const cliente = document.getElementById('reservaCliente').value.trim();
        const telefono = document.getElementById('reservaTelefono').value.trim();
        const fecha = document.getElementById('reservaFecha').value;
        const horaInicio = document.getElementById('reservaHoraInicio').value;
        const horaFin = document.getElementById('reservaHoraFin').value;
        const personas = parseInt(document.getElementById('reservaPersonas').value);
        const mesa = document.getElementById('reservaMesa').value;
        const estado = document.getElementById('reservaEstado').value;
        const ocasion = document.getElementById('reservaOcasión').value;
        
        if (!cliente || !fecha || !horaInicio || !horaFin) return notify('Datos incompletos', 'error');
        if (!validarHorasReserva(horaInicio, horaFin)) return;
        
        // Verificar disponibilidad de la mesa
        if (!verificarDisponibilidadMesa(mesa, fecha, horaInicio, horaFin, currentReservaId)) {
          return notify('La mesa no está disponible en el horario seleccionado', 'error');
        }

        if (currentReservaId) {
          const r = reservas.find(r => r.id === currentReservaId);
          Object.assign(r, { cliente, telefono, fecha, horaInicio, horaFin, personas, mesa, estado, ocasion });
        } else {
          reservas.push({ 
            id: 'r' + Date.now(), 
            cliente, 
            telefono, 
            fecha, 
            horaInicio, 
            horaFin, 
            personas, 
            mesa, 
            estado, 
            ocasion 
          });
        }

        setLS(LS_KEYS.MESAS, mesas);
        setLS(LS_KEYS.RESERVAS, reservas);
        renderMesas();
        renderReservas();
        populateMesaFilter(); // Actualizar el filtro de mesas
        bootstrap.Modal.getInstance(document.getElementById('reservaModal')).hide();
        currentReservaId = null;
        notify('Reserva guardada');
      };

      function pagarReserva(id) {
        const r = reservas.find(r => r.id === id);
        if (!r) return;
        Swal.fire({
          title: '¿Desea pagar y liberar la mesa?',
          icon: 'question',
          showCancelButton: true,
          confirmButtonText: 'Sí, pagar',
          cancelButtonText: 'Cancelar'
        }).then(res => {
          if (res.isConfirmed) {
            r.estado = 'Finalizada';
            setLS(LS_KEYS.MESAS, mesas);
            setLS(LS_KEYS.RESERVAS, reservas);
            renderMesas();
            renderReservas();
            notify('Pago realizado y mesa liberada');
          }
        });
      }

      function eliminarMesa(id) { 
        mesas = mesas.filter(m => m.id !== id); 
        // También eliminar reservas asociadas a esta mesa
        reservas = reservas.filter(r => r.mesa !== id);
        setLS(LS_KEYS.MESAS, mesas); 
        setLS(LS_KEYS.RESERVAS, reservas);
        renderMesas(); 
        renderReservas();
        populateMesaFilter(); // Actualizar el filtro de mesas
        notify('Mesa eliminada'); 
      }
      
      function eliminarReserva(id) { 
        reservas = reservas.filter(r => r.id !== id); 
        setLS(LS_KEYS.RESERVAS, reservas); 
        renderMesas();
        renderReservas(); 
        populateMesaFilter(); // Actualizar el filtro de mesas
        notify('Reserva eliminada'); 
      }

      // Actualizar el estado de las mesas cada minuto
      function iniciarActualizacionAutomatica() {
        setInterval(() => {
          renderMesas();
        }, 60000); // Actualizar cada minuto  
      }

      (function boot() { 
        initMesasDefault(); 
        mesas = getLS(LS_KEYS.MESAS); 
        reservas = getLS(LS_KEYS.RESERVAS); 
        renderMesas(); 
        renderReservas(); 
        populateMesaFilter();
        iniciarActualizacionAutomatica();
        notify('Datos cargados'); 
      })();
    </script>
</body>

</html> 